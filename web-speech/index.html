<!DOCTYPE html>
<html lang="en">

<head>
  <title>web speech</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <style>
    section {
      margin-block-end: 1em;
    }
  </style>
</head>

<body>
  <main>
    <section>
      <form id="speech">
        <section>
          <textarea name="content" placeholder="Please input something..." rows="5" cols="30"></textarea>
        </section>

        <section>
          <label for="voice">Choose a voice:</label>
          <input list="voiceSelect" id="voice" name="voice">

          <datalist id="voiceSelect">
          </datalist>
        </section>

        <section>
          <button id="speak" type="button">speak</button>
          <button id="pause" type="button">pause</button>
          <button id="resume" type="button">resume</button>
          <button id="cancel" type="button">cancel</button>
        </section>

      </form>
    </section>
  </main>
  <script type="module">
    let voices;
    const speechForm = document.querySelector('#speech');
    const speakBtn = document.querySelector('#speak');
    const pauseBtn = document.querySelector('#pause');
    const resumeBtn = document.querySelector('#resume');
    const cancelBtn = document.querySelector('#cancel');

    speakBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const fd = new FormData(speechForm);
      const content = fd.get('content');
      const voiceOption = fd.get('voice');

      if (!content) {
        alert('There is nothing to speak!');
        return
      }

      const utterance = new SpeechSynthesisUtterance(content);
      for (const voice of voices) {
        if (generateVoiceContent(voice) === voiceOption) {
          utterance.voice = voice;
        }
      }
      speechSynthesis.speak(utterance);
    });

    pauseBtn.addEventListener('click', (e) => {
      e.preventDefault();
      speechSynthesis.pause();
    })

    resumeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      speechSynthesis.resume();
    })

    cancelBtn.addEventListener('click', (e) => {
      e.preventDefault();
      speechSynthesis.cancel();
    })

    function generateVoiceContent(voice) {
      const { name, lang, default: d } = voice;
      let content = `${name} (${lang})`;
      if (d) {
        content += ' - DEFAULT';
      }
      return content;
    }

    function populateVoiceList() {
      if (typeof speechSynthesis === "undefined") {
        return;
      }

      voices = speechSynthesis.getVoices();

      for (let i = 0; i < voices.length; i++) {
        const option = document.createElement("option");
        const voice = voices[i];
        option.textContent = generateVoiceContent(voice);

        voiceSelect.appendChild(option);
      }
    }

    populateVoiceList();
    if (
      typeof speechSynthesis !== "undefined" &&
      speechSynthesis.onvoiceschanged !== undefined
    ) {
      speechSynthesis.onvoiceschanged = populateVoiceList;
    }

  </script>
</body>

</html>